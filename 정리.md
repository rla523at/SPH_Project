# SPH Frame Work
## Integral Representation
임의의 $f:\R^3\rightarrow \R$가 있을 떄, 임의의 $x \in \Omega \subseteq \R^3$에 대해서 다음이 성립한다.

$$ f(x) = \int_{\Omega} f(t)\delta(x-t)dt $$

$\delta$는 dirac-delta function kernel이다.

## Approximation of Integral Representation
$\delta$를 임의의 smooth kernel function $W(x,h):\R^3 \rightarrow \R$로 근사하면 다음과 같다.

$$ f(x) \approx \int_{\Omega} f(t)W(x-t, h)dt $$

이처럼, $\delta$를 임의의 smooth function으로 approximation을 하기 때문에 'smoothed' particle hydronamics라고 한다.

## Smooth Kernel Function
$W(x,h)$는 $\delta$를 근사한 함수이기 때문에 다음 세가지 조건을 만족해야한다.

Normalization condition

$$ \int_\Omega W(x-t,h)dt = 1$$

Delta Function Property

$$ \lim_{h\rightarrow 0} W(x-t,h) = \delta(x-t)$$

Compact Supprot Property

$$ \kappa h < |x-t| \implies W(x-t,h) = 0 $$

따라서, $h$에 의해 $W$의 compact support domain이 결정되며, $h$를 support length라고 한다.

[그림]

## Particle Approximation
$W$를 이용한 Integral Representation의 approximation은 discretized form으로 한번 더 근사가 될 수 있다.

$$ \begin{aligned} f(x) &\approx \int_{\Omega} f(t)W(x-t, h)dt \\ &\approx \sum_{j} f(x_j)W(x-x_j,h) \Delta V_j \\ &= \sum_{j} f(x_j)W(x-x_j,h) \frac{\rho_j \Delta V_j}{\rho_j} \\ &= \sum_{j} f(x_j)W(x-x_j,h) \frac{m_j}{\rho_j} \end{aligned}  $$

[그림]

따라서, SPH frame work상 임의의 물리량 $f$에 대한 최종 근사식은 다음과 같다.

$$ f(x) = \sum_j \frac{m_j}{\rho_j}f(x_j) W(x,x_j,h) $$

# Density Calculation
SPH 근사식에 밀도를 대입하면 다음과 같다.

$$ \rho(x) = \sum_j m_jW(x,x_j,h) $$

## 참고
* 비압축성 유체이기 때문에 $m_j$가 일정하다고 가정하면 밀도는 오직 거리의 함수이다. 따라서, 바로 바로 밀도를 업데이트해도 아무런 문제가 안된다.


# smoothing length
3차원 기준 neighbor가 50개가 되도록 잡는게 좋다.

> Reference  
> https://scicomp.stackexchange.com/questions/16363/how-to-choose-h-in-sph  

# mass
* normalized mass
  * [note] 2011 (cornell)  

* density * particle volume
  * 1994 (monaghan) Simulating Free Surface Flows with SPH

# Density Flucutation
* 0.01 rho0
  * 2007 (Markus and Matthias) Weakly compressible SPH for free surface flows
  * density fluctuation ~ M^2, M= 0.1, 
* 

# Presssure Constant
* 1119kPa ~ 10^6
  * 2007 (Markus and Matthias) Weakly compressible SPH for free surface flows

# 상수정리
* https://github.com/lucas-schuermann/mueller-sph/blob/master/src/main.cpp
  * H = 16
  * Mass = 2.5
  * Visc = 200
  * rho0 = 300
  * k = 2000
* https://www.cs.cornell.edu/~bindel/class/cs5220-f11/code/sph.pdf
  * H = 5.0e-2
  * mu = 0.1
  * k = 1.0e3
* https://github.com/tiernsum/2D-SPH-Formulation/blob/master/SPH.h
  * k = 2000
  * m = 1.0
  * k = 2000
* https://scicomp.stackexchange.com/questions/14450/how-to-get-proper-parameters-of-sph-simulation
* 
* 

# Kernels
* https://pysph.readthedocs.io/en/latest/reference/kernels.html
* https://www.cs.cornell.edu/~bindel/class/cs5220-f11/code/sph.pdf

# Neighborhood Search
## Index Sort
unifrom grid는 동시에 같은 memory에 접근하는 race condition으로 parallel construction이 어렵다.

memory conflict를 피하기 위해 먼저 particle을 cell index로 sorting한다.

## Spatial Hashing



# Pressure Computation
* Equation of State(EOS)

# Time Integration